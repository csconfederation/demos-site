$(function(t){function i(t,i,e){var n=i.find("Key").text();this.name=n.substring(t.length),this.href=e+n,this.title=this.name.split("-").slice(0,-1).join("-").trim(),this.title.match(/^The\s/i)&&(this.title=this.title.replace(/^The\s/i,"")+", The"),this.date=new Date(i.find("LastModified").text()),this.size=parseInt(i.find("Size").text()),this.toRow=function(){return!this.name||s.indexOf(n)>-1?void 0:["<tr>",'<td><span class="ion-document-text"></span></td>','<td><a href="',this.href,'">',this.name,"</a></td>","<td>",this.date.toLocaleString(),"</td>","<td>",this.size.toBytes(),"</td>","</tr>"].join("")}}function e(t){var i=t.find("Prefix").text();this.name=i.split("/").slice(-2).join("/"),this.title=this.name.split("-").slice(0,-1).join("-").trim(),this.title.match(/^The\s/i)&&(this.title=this.title.replace(/^The\s/i,"")+", The"),this.href=location.pathname+"?path="+i,this.toRow=function(){return!this.name||a.indexOf(this.name)>-1?void 0:["<tr>",'<td><span class="ion-ios7-folder"></span></td>','<td><a href="',this.href,'">',this.name,"</a></td>","<td></td><td>-</td>","</tr>"].join("")}}function n(t){this.path=t.replace(/\/$/,"").split("/").slice(0,-1).concat("").join("/"),this.toRow=function(){return['<tr><td class="ion-arrow-return-left">',"</td><td colspan=3>",'<a href="?path=',this.path,'">../</a>',"</td></tr>"].join("")}}function o(o,r){var o=t(o),s=t(o.find("Prefix")[0]).text();this.files=t.map(o.find("Contents"),function(e){return new i(s,t(e),r)}),this.dirs=t.map(o.find("CommonPrefixes"),function(i){return new e(t(i))}),this.render=function(){var i=t("#items tbody");i.html("").parent().show(),s&&i.append(new n(s).toRow()),t.each(this.dirs,function(t,e){i.append(e.toRow())}),t.each(this.files,function(t,e){i.append(e.toRow())})}}Number.prototype.toBytes=function(){if(0===this)return"0 bytes";var t=parseInt(Math.floor(Math.log(this)/Math.log(1024))),i=Math.round(this/Math.pow(1024,t)*10)/10;return[i,["bytes","KB","MB","GB","TB"][t]].join(" ")},Array.prototype.sortBy=function(t,i){var e="asc"===i;return this.sort(function(i,n){return i[t]<n[t]?e?1:-1:i[t]>n[t]?e?-1:1:0})};var r,s=[".htpasswd","index.html","robots.txt","favicon.ico"],a=["fonts/","js/"],c={setCookie:function(t){document.cookie="decryptKey="+t+"; path=/"},readCookie:function(){for(var t="decryptKey=",i=document.cookie.split(";"),e=0;e<i.length;e++){for(var n=i[e];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},eraseCookie:function(){var t="expires="+new Date(0).toUTCString();document.cookie="decryptKey=;"+t+"; path=/"}};t(".sortable").click(function(i){var e=t(this),n=e.attr("data-dir"),o=e.attr("data-field");r.files=r.files.sortBy(o,n),r.dirs="title"===o?r.dirs.sortBy(o,n):r.dirs.sortBy("title","desc"),r.render(),t(".sortable").removeClass("active"),e.addClass("active"),e.attr("data-dir","asc"===n?"desc":"asc")});var h=function(t){var i=t+"?delimiter=/",e=/.*[?&]path=([^&]+)(&.*)?$/,n=location.search.match(e);if(n){var o=n[1].replace(/\/$/,"")+"/";i+="&prefix="+o}return i},d=function(i,e){i?t.get(h(i)).done(e.success).fail(e.failure):e.failure()},f=function(t,i){try{var e=CryptoJS.AES.decrypt(t,i);return e.toString(CryptoJS.enc.Utf8)}catch(n){}},l=function(i,e){t("#loading, #login").hide(),r=new o(i,e),t(".sortable.active").click()};t("#login").on("submit",function(i){var e=t(this).find("input").val(),n=f(window.SECRET_BUCKET_URL,e);return t("#login").hide(),t("#loading").show(),d(n,{success:function(t){c.setCookie(e),l(t,n)},failure:function(t){alert("Incorrect Password"),u()}}),!1});var u=function(){if(window.SECRET_BUCKET_URL)if(c.readCookie()){var i=f(window.SECRET_BUCKET_URL,c.readCookie());d(i,{success:function(t){l(t,i)},failure:function(t){c.eraseCookie(),u()}})}else t("#loading").hide(),t("#login").show().find("input").focus();else d(window.S3_BUCKET_URL,{success:function(t){l(t,window.S3_BUCKET_URL)},failure:function(t){alert("Something went wrong."),console.error(t)}})};u()});
