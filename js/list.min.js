Number.prototype.toBytes=function(){if(0===this)return"0 bytes";var a=parseInt(Math.floor(Math.log(this)/Math.log(1024))),b=Math.round(this/Math.pow(1024,a)*10)/10;return[b,["bytes","KB","MB","GB","TB"][a]].join(" ")},Array.prototype.sortBy=function(a,b){var c="asc"===b;return this.sort(function(b,d){return b[a]<d[a]?c?1:-1:b[a]>d[a]?c?-1:1:0})};var KeyStore={setCookie:function(a){document.cookie="decryptKey="+a+"; path=/"},readCookie:function(){for(var a="decryptKey=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null},eraseCookie:function(){var a="expires="+new Date(0).toUTCString();document.cookie="decryptKey=;"+a+"; path=/"}};$(function(a){function b(a,b,c){var d=b.find("Key").text(),e=d.substring(a.length),f={name:e,title:e.replace(/^The\s*/i,""),href:c+escape(d),date:new Date(b.find("LastModified").text()).toLocaleString(),size:parseInt(b.find("Size").text()).toBytes()};this.toRow=function(){return e?render(template,f):void 0}}function c(a){var b=a.find("Prefix").text();this.name=b.split("/").slice(-2).join("/"),this.title=this.name.trim(),this.title.match(/^The\s/i)&&(this.title=this.title.replace(/^The\s/i,"")),this.href=location.pathname+"?path="+escape(b),this.toRow=function(){return this.name?["<tr>",'<td nowrap><span class="ion-ios7-folder"></span></td>','<td nowrap><a href="',this.href,'">',this.name,"</a></td>","<td nowrap></td><td>-</td>","</tr>"].join(""):void 0}}function d(a){this.path=escape(a.replace(/\/$/,"").split("/").slice(0,-1).concat("").join("/")),this.toRow=function(){return['<tr><td class="ion-arrow-return-left">',"</td><td colspan=3>",'<a href="?path=',this.path,'">../</a>',"</td></tr>"].join("")}}function e(e,f){var e=a(e),g=a(e.find("Prefix")[0]).text();this.files=a.map(e.find("Contents"),function(c){return new b(g,a(c),f)}),this.dirs=a.map(e.find("CommonPrefixes"),function(b){return new c(a(b))}),this.render=function(){var b=a("#items tbody");b.html("").parent().show(),g&&b.append(new d(g).toRow()),a.each(this.dirs,function(a,c){b.append(c.toRow())}),a.each(this.files,function(a,c){b.append(c.toRow())})}}var f;a(".sortable").click(function(b){var c=a(this),d=c.attr("data-dir"),e=c.attr("data-field");f.files=f.files.sortBy(e,d),f.dirs="title"===e?f.dirs.sortBy(e,d):f.dirs.sortBy("title","desc"),f.render(),a(".sortable").removeClass("active"),c.addClass("active"),c.attr("data-dir","asc"===d?"desc":"asc")});var g=function(a){var b=a+"?delimiter=/",c=/.*[?&]path=([^&]+)(&.*)?$/,d=location.search.match(c);if(d){var e=d[1].replace(/\/$/,"")+"/";b+="&prefix="+e}return b},h=function(b,c){b?a.get(g(b)).done(c.success).fail(c.failure):c.failure()},i=function(b,c){a("#loading, #login").hide(),f=new e(b,c),a(".sortable.active").click()},j=function(a,b){try{var c=CryptoJS.AES.decrypt(a,b);return c.toString(CryptoJS.enc.Utf8)}catch(d){}};a("#login").on("submit",function(b){var c=a(this).find("input").val(),d=j(window.SECRET_BUCKET_URL,c);return a("#login").hide(),a("#loading").show(),h(d,{success:function(a){KeyStore.setCookie(c),i(a,d)},failure:function(a){alert("Incorrect Password"),k()}}),!1});var k=function(){if(window.SECRET_BUCKET_URL)if(KeyStore.readCookie()){var b=j(window.SECRET_BUCKET_URL,KeyStore.readCookie());h(b,{success:function(a){i(a,b)},failure:function(a){KeyStore.eraseCookie(),k()}})}else a("#loading").hide(),a("#login").show().find("input").focus();else h(window.S3_BUCKET_URL,{success:function(a){i(a,window.S3_BUCKET_URL)},failure:function(a){alert("Something went wrong."),console.error(a)}})},l=0,m=function(){return l++,l>25?k():void(window.S3_CONFIG_LOADED?k():setTimeout(m,25))};m()});