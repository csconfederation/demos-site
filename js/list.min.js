$(function(t){function i(t,i,e){var n=i.find("Key").text();this.name=n.substring(t.length),this.href=e+n,this.title=this.name.split("-").slice(0,-1).join("-").trim(),this.title.match(/^The\s/i)&&(this.title=this.title.replace(/^The\s/i,"")+", The"),this.date=new Date(i.find("LastModified").text()),this.size=parseInt(i.find("Size").text()),this.toRow=function(){return!this.name||s.indexOf(n)>-1?void 0:["<tr>",'<td><span class="ion-document-text"></span></td>','<td><a href="',this.href,'">',this.name,"</a></td>","<td>",this.date.toLocaleString(),"</td>","<td>",this.size.toBytes(),"</td>","</tr>"].join("")}}function e(t){var i=t.find("Prefix").text();this.name=i.split("/").slice(-2).join("/"),this.title=this.name.split("-").slice(0,-1).join("-").trim(),this.title.match(/^The\s/i)&&(this.title=this.title.replace(/^The\s/i,"")+", The"),this.href=location.pathname+"?path="+i,this.toRow=function(){return!this.name||a.indexOf(this.name)>-1?void 0:["<tr>",'<td><span class="ion-ios7-folder"></span></td>','<td><a href="',this.href,'">',this.name,"</a></td>","<td></td><td>-</td>","</tr>"].join("")}}function n(t){this.path=t.replace(/\/$/,"").split("/").slice(0,-1).concat("").join("/"),this.toRow=function(){return['<tr><td class="ion-arrow-return-left">',"</td><td colspan=3>",'<a href="?path=',this.path,'">../</a>',"</td></tr>"].join("")}}function r(r,o){var r=t(r),s=t(r.find("Prefix")[0]).text();this.files=t.map(r.find("Contents"),function(e){return new i(s,t(e),o)}),this.dirs=t.map(r.find("CommonPrefixes"),function(i){return new e(t(i))}),this.render=function(){var i=t("#items tbody");i.html("").parent().show(),s&&i.append(new n(s).toRow()),t.each(this.dirs,function(t,e){i.append(e.toRow())}),t.each(this.files,function(t,e){i.append(e.toRow())})}}Number.prototype.toBytes=function(){if(0===this)return"0 bytes";var t=parseInt(Math.floor(Math.log(this)/Math.log(1024))),i=Math.round(this/Math.pow(1024,t)*10)/10;return[i,["bytes","KB","MB","GB","TB"][t]].join(" ")},Array.prototype.sortBy=function(t,i){var e="asc"===i;return this.sort(function(i,n){return i[t]<n[t]?e?1:-1:i[t]>n[t]?e?-1:1:0})};var o,s=[".htpasswd","index.html","robots.txt","favicon.ico"],a=["fonts/","js/"];t(".sortable").click(function(i){var e=t(this),n=e.attr("data-dir"),r=e.attr("data-field");o.files=o.files.sortBy(r,n),o.dirs="title"===r?o.dirs.sortBy(r,n):o.dirs.sortBy("title","desc"),o.render(),t(".sortable").removeClass("active"),e.addClass("active"),e.attr("data-dir","asc"===n?"desc":"asc")});var h=function(t){var i=t+"?delimiter=/",e=/.*[?&]path=([^&]+)(&.*)?$/,n=location.search.match(e);if(n){var r=n[1].replace(/\/$/,"")+"/";i+="&prefix="+r}return i},d=function(i,e){e&&(i=c(window.SECRET_BUCKET_URL,e));var n=i.replace(/\/$/,"")+"/";t.get(h(n)).done(function(i){e&&(document.cookie="decryptKey="+e+"; path=/"),t("#loading").hide(),o=new r(i,n),t(".sortable.active").click()}).fail(function(t){e?(document.cookie="decryptKey=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",alert("Incorrect Password"),f()):alert("There was an error"),console.error(t)})},c=function(t,i){try{var e=CryptoJS.AES.decrypt(t,i);return e.toString(CryptoJS.enc.Utf8)}catch(n){return""}};t("#login").on("submit",function(i){var e=t(this).find("input").val();return t("#login").hide(),t("#loading").show(),d(window.SECRET_BUCKET_URL,e),!1});var f=function(){if(window.SECRET_BUCKET_URL){var i=(document.cookie.match("(^|; )decryptKey=([^;]*)")||0)[2];i?d(window.SECRET_BUCKET_URL,i):(t("#loading").hide(),t("#login").show().find("input").focus())}else d(window.S3_BUCKET_URL)};f()});
