$(function(t){function n(t,n){var e=n.find("Key").text();this.name=e.substring(t.length),this.date=new Date(n.find("LastModified").text()),this.size=parseInt(n.find("Size").text()),this.toRow=function(){return!this.name||d.indexOf(e)>-1?void 0:["<tr>",'<td><a href="/',e,'">',this.name,"</a></td>","<td>",this.date.toLocaleString(),"</td>","<td>",s(this.size),"</td>","</tr>"].join("")}}function e(t){var n=t.find("Prefix").text();this.name=n.split("/").slice(-2).join("/"),this.href=location.pathname+"?path="+n,this.toRow=function(){return["<tr>",'<td><a href="',this.href,'">',this.name,"</a></td>","<td></td><td>-</td>","</tr>"].join("")}}function i(t){this.path=t.replace(/\/$/,"").split("/").slice(0,-1).concat("").join("/"),this.toRow=function(){return["<tr><td colspan=3>",'<a href="?path=',this.path,'">../</a>',"</td></tr>"].join("")}}function a(a){var a=t(a),r=t(a.find("Prefix")[0]).text(),o=t.map(a.find("Contents"),function(e){return new n(r,t(e))}),s=t.map(a.find("CommonPrefixes"),function(n){return new e(t(n))});this.render=function(){var n=t("#items tbody");n.html("").parent().show(),r&&n.append(new i(r).toRow()),t.each(s,function(t,e){n.append(e.toRow())}),t.each(o,function(t,e){n.append(e.toRow())})},this.sortBy=function(t,n){var e="asc"===n;o=o.sort(function(n,i){return n[t]<i[t]?e?1:-1:n[t]>i[t]?e?-1:1:0})}}var r,o=function(){var t=window.S3_BUCKET_URL+"?delimiter=/",n=/.*[?&]path=([^&]+)(&.*)?$/,e=location.search.match(n);if(e){var i=e[1].replace(/\/$/,"")+"/";t+="&prefix="+i}return t}(),s=function(t){if(0==t)return"0 bytes";var n=parseInt(Math.floor(Math.log(t)/Math.log(1024))),e=Math.round(t/Math.pow(1024,n)*10)/10;return[e,["bytes","KB","MB","GB","TB"][n]].join(" ")},d=["index.html","list.js","robots.txt","favicon.ico"];t(".sortable").click(function(){var n=t(this),e=n.attr("data-dir"),i=n.attr("data-field");r.sortBy(i,e),r.render(),t(".sortable").removeClass("active"),n.addClass("active"),n.attr("data-dir","asc"===e?"desc":"asc")}),t.get(o).done(function(n){t("#loading").hide(),r=new a(n),r.render()}).fail(function(t){alert("There was an error"),console.error(t)})});
